#include "NXCDefs.h"

inline void turnR(int speed)//Turns right
{
  	OnFwd(OUT_A, speed);
		OnRev(OUT_C, speed);
}
inline void turnL(int speed)//Turns left
{
  	OnFwd(OUT_A, speed);
		OnRev(OUT_C, speed);
}

inline void move_fwd(int distance)
{
 int i;
 OnFwdReg(OUT_AC, 75, OUT_REGMODE_SYNC);
 i = SensorUS(IN_4);
 	while(i>distance) //Runs untill robot is within distance
 	{
 		i = SensorUS(IN_4);
 	}
 Off(OUT_AC);
}

inline void drop()//Book dropoff
{
       RotateMotor(OUT_B, 20, -150);
       Wait(1000);

       OnRevReg(OUT_AC, 50, OUT_REGMODE_SYNC);
       Wait(500);
       Off(OUT_AC);

       RotateMotor(OUT_B, 20, 150);
}

inline void Find() //Finds the wall and lines up the robot
{
 	int range,right,left;
	range=SensorUS(IN_4);
	turnR(40);

	while(range>70)//Untill wall is found
	{
		range=SensorUS(IN_4);
	}
	Off(OUT_AC);

	left=SensorUS(IN_4); // Sets first point to compare

	turnR(50);
	Wait(300);
	Off(OUT_AC);

	right=SensorUS(IN_4); // Sets second point to compare

	while(left>right&&left!=right)// Runs untill right compare point is bigger than left
	{
		turnR(50);
		Wait(200);
		Off(OUT_AC);
		left = right;
		right = SensorUS(IN_4);
	}

// Turns one step back so it is lined up with wall
turnL(50);
Wait(500);
Off(OUT_AC);

}
inline void paket1()   // Right 2.5m
{
	RotateMotor(OUT_A, 75, 360); //Turns the robot right 90Degrees
	Off(OUT_A);
	Wait(1000);// To ensure the robot is not interrupted by next task


	OnFwdReg(OUT_AC, 100, OUT_REGMODE_SPEED);//Runs the robot 2.5m in a line
	Wait(8000);
  Off(OUT_AC);

	Find();

	move_fwd(20);

	drop();

}

task main()
{
	SetSensorLowspeed(IN_4);
 	Find();  // Finds the wall
 	move_fwd(40);
 	paket1();

}
